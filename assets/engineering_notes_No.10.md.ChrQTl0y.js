import{_ as l,C as e,c as h,o as p,ac as n,j as i,a,G as d,w as k}from"./chunks/framework.CtEZafqV.js";const C=JSON.parse('{"title":"Note 10","description":"","frontmatter":{},"headers":[],"relativePath":"engineering/notes/No.10.md","filePath":"engineering/notes/No.10.md","lastUpdated":1766111155000}'),o={name:"engineering/notes/No.10.md"};function r(c,s,g,E,y,F){const t=e("Tag");return p(),h("div",null,[s[14]||(s[14]=n(`<h1 id="note-10" tabindex="-1">Note 10 <a class="header-anchor" href="#note-10" aria-label="Permalink to &quot;Note 10&quot;">​</a></h1><h2 id="样式隔离-css-in-js-css-modules-scoped-css-shadow-dom-web-components" tabindex="-1">样式隔离（CSS-in-JS &amp; CSS Modules &amp; Scoped CSS &amp; Shadow DOM (Web Components)） <a class="header-anchor" href="#样式隔离-css-in-js-css-modules-scoped-css-shadow-dom-web-components" aria-label="Permalink to &quot;样式隔离（CSS-in-JS &amp; CSS Modules &amp; Scoped CSS &amp; Shadow DOM (Web Components)）&quot;">​</a></h2><h3 id="_1-css-in-js" tabindex="-1">1. CSS-in-JS <a class="header-anchor" href="#_1-css-in-js" aria-label="Permalink to &quot;1. CSS-in-JS&quot;">​</a></h3><h4 id="概念" tabindex="-1">概念 <a class="header-anchor" href="#概念" aria-label="Permalink to &quot;概念&quot;">​</a></h4><br><p>将 <code>CSS</code> 样式直接写在 <code>JavaScript/TypeScript</code> 代码中，通过运行时或构建时生成唯一的类名来实现样式隔离。</p><h4 id="核心实现" tabindex="-1">核心实现 <a class="header-anchor" href="#核心实现" aria-label="Permalink to &quot;核心实现&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 示例：使用 styled-components</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> styled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;styled-components&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Button</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> styled.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">button</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  background: \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">props</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> props</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">primary</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;blue&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;gray&#39;};</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  color: white;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  padding: 10px 20px;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  border-radius: 4px;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> primary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Click me&lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h4 id="特点" tabindex="-1">特点 <a class="header-anchor" href="#特点" aria-label="Permalink to &quot;特点&quot;">​</a></h4><ul><li><strong>动态样式</strong>：可以根据组件状态/属性动态生成样式</li><li><strong>JS完全控制</strong>：样式逻辑可以用 <code>JavaScript</code> 表达</li><li><strong>运行时生成</strong>：大多数方案在运行时生成样式并插入到 <code>DOM</code></li><li><strong>框架绑定</strong>：通常与 <code>React</code> 等框架深度集成</li></ul><h4 id="主流库" tabindex="-1">主流库 <a class="header-anchor" href="#主流库" aria-label="Permalink to &quot;主流库&quot;">​</a></h4><ul><li><strong>styled-components</strong></li><li><strong>Emotion</strong></li><li><strong>JSS</strong></li></ul><h3 id="_2-css-modules" tabindex="-1">2. CSS Modules <a class="header-anchor" href="#_2-css-modules" aria-label="Permalink to &quot;2. CSS Modules&quot;">​</a></h3><h4 id="概念-1" tabindex="-1">概念 <a class="header-anchor" href="#概念-1" aria-label="Permalink to &quot;概念&quot;">​</a></h4><br><p>在构建时（如<code>Webpack</code>）将 <code>CSS</code> 类名编译为唯一哈希值，实现局部作用域。</p><h4 id="实现方式" tabindex="-1">实现方式 <a class="header-anchor" href="#实现方式" aria-label="Permalink to &quot;实现方式&quot;">​</a></h4><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Button.module.css */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">white</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Button.jsx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> styles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./Button.module.css&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{styles.button}&gt;Click me&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 编译后的HTML类似：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &lt;button class=&quot;Button_button__1a2b3&quot;&gt;Click me&lt;/button&gt;</span></span></code></pre></div><h4 id="特点-1" tabindex="-1">特点 <a class="header-anchor" href="#特点-1" aria-label="Permalink to &quot;特点&quot;">​</a></h4><ul><li><strong>构建时处理</strong>：在打包阶段转换类名</li><li><strong>真正的局部作用域</strong>：类名经过哈希处理，不会冲突</li><li><strong>支持预处理器</strong>：可以使用 <code>Sass/Less</code> 等</li><li><strong>简单直观</strong>：编写方式接近传统 <code>CSS</code></li></ul><h3 id="_3-scoped-css" tabindex="-1">3. Scoped CSS <a class="header-anchor" href="#_3-scoped-css" aria-label="Permalink to &quot;3. Scoped CSS&quot;">​</a></h3><h4 id="概念-2" tabindex="-1">概念 <a class="header-anchor" href="#概念-2" aria-label="Permalink to &quot;概念&quot;">​</a></h4><br><p>通过为组件添加唯一的属性选择器，限制样式的作用范围。</p><h4 id="vue中的实现" tabindex="-1">Vue中的实现 <a class="header-anchor" href="#vue中的实现" aria-label="Permalink to &quot;Vue中的实现&quot;">​</a></h4><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;button&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Click me&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scoped</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* 只会作用于当前组件 */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.container</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">blue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">white</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* 编译后类似：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">.container[data-v-f3f3eg9] { ... }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">.button[data-v-f3f3eg9] { ... }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h4 id="特点-2" tabindex="-1">特点 <a class="header-anchor" href="#特点-2" aria-label="Permalink to &quot;特点&quot;">​</a></h4><ul><li><strong>框架集成</strong>：主要在 <code>Vue</code> 中使用</li><li><strong>选择器限制</strong>：通过属性选择器实现作用域</li><li><strong>子组件限制</strong>：默认不影响子组件内部（除根元素外）</li></ul><h3 id="_4-shadow-dom-web-components" tabindex="-1">4. Shadow DOM（Web Components） <a class="header-anchor" href="#_4-shadow-dom-web-components" aria-label="Permalink to &quot;4. Shadow DOM（Web Components）&quot;">​</a></h3><h4 id="概念-3" tabindex="-1">概念 <a class="header-anchor" href="#概念-3" aria-label="Permalink to &quot;概念&quot;">​</a></h4><br><p>浏览器原生支持的 <code>DOM</code> 和样式封装技术，创建完全隔离的 <code>DOM</code> 子树。</p><h4 id="实现" tabindex="-1">实现 <a class="header-anchor" href="#实现" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyComponent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 创建Shadow DOM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> shadow</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;open&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 添加样式和内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shadow.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &lt;style&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        /* 这些样式完全隔离，不影响外部 */</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        button {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          background: blue;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          color: white;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          padding: 10px 20px;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        /* 外部样式无法影响这里 */</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &lt;/style&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &lt;button&gt;Click me&lt;/button&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">customElements.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">define</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-component&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, MyComponent)</span></span></code></pre></div><h4 id="特点-3" tabindex="-1">特点 <a class="header-anchor" href="#特点-3" aria-label="Permalink to &quot;特点&quot;">​</a></h4><ul><li><strong>完全隔离</strong>：<code>DOM</code> 和样式都完全独立</li><li><strong>原生支持</strong>：浏览器原生特性，无需构建工具</li><li><strong>真正的封装</strong>：外部无法访问内部 <code>DOM</code> 结构</li><li><strong>事件重定向</strong>：事件需要特别处理才能冒泡到外部</li></ul><h3 id="对比分析" tabindex="-1">对比分析 <a class="header-anchor" href="#对比分析" aria-label="Permalink to &quot;对比分析&quot;">​</a></h3><table tabindex="0"><thead><tr><th>特性</th><th><code>CSS-in-JS</code></th><th><code>CSS Modules</code></th><th><code>Scoped CSS</code></th><th><code>Shadow DOM</code></th></tr></thead><tbody><tr><td><strong>作用域</strong></td><td>运行时生成唯一类名</td><td>构建时生成唯一类名</td><td>属性选择器限制</td><td>完全隔离的 <code>DOM</code> 树</td></tr><tr><td><strong>样式封装</strong></td><td>✓</td><td>✓</td><td>✓</td><td>✓✓（最强）</td></tr><tr><td><strong>DOM封装</strong></td><td>✗</td><td>✗</td><td>✗</td><td>✓</td></tr><tr><td><strong>动态样式</strong></td><td>✓✓</td><td>有限</td><td>有限</td><td>✓</td></tr><tr><td><strong>构建依赖</strong></td><td>需要</td><td>需要</td><td>需要</td><td>不需要</td></tr><tr><td><strong>性能</strong></td><td>运行时开销</td><td>构建时处理</td><td>构建时处理</td><td>原生性能好</td></tr><tr><td><strong>学习曲线</strong></td><td>中</td><td>低</td><td>低</td><td>中高</td></tr><tr><td><strong>框架绑定</strong></td><td>通常与 <code>React</code> 绑定</td><td>框架无关</td><td>主要在 <code>Vue</code></td><td>框架无关</td></tr><tr><td><strong>SSR支持</strong></td><td>部分库支持</td><td>✓</td><td>✓</td><td>原生支持</td></tr><tr><td><strong>样式继承</strong></td><td>支持</td><td>支持</td><td>有限</td><td>默认隔离，需手动开放</td></tr></tbody></table><h3 id="使用场景建议" tabindex="-1">使用场景建议 <a class="header-anchor" href="#使用场景建议" aria-label="Permalink to &quot;使用场景建议&quot;">​</a></h3><h4 id="选择css-in-js当" tabindex="-1">选择<code>CSS-in-JS</code>当： <a class="header-anchor" href="#选择css-in-js当" aria-label="Permalink to &quot;选择\`CSS-in-JS\`当：&quot;">​</a></h4><ul><li>项目重度使用 <code>React</code></li><li>需要高度动态的样式（主题切换、动画等）</li><li>希望样式与组件逻辑紧密结合</li><li>不介意一定的运行时开销</li></ul><h4 id="选择css-modules当" tabindex="-1">选择<code>CSS Modules</code>当： <a class="header-anchor" href="#选择css-modules当" aria-label="Permalink to &quot;选择\`CSS Modules\`当：&quot;">​</a></h4><ul><li>希望接近传统 <code>CSS</code> 开发体验</li><li>项目对性能要求较高（减少运行时开销）</li><li>需要与多种框架配合使用</li><li>团队更熟悉 <code>CSS</code> 预处理器</li></ul><h4 id="选择scoped-css当" tabindex="-1">选择<code>Scoped CSS</code>当： <a class="header-anchor" href="#选择scoped-css当" aria-label="Permalink to &quot;选择\`Scoped CSS\`当：&quot;">​</a></h4><ul><li>使用 <code>Vue.js</code> 框架</li><li>需要简单直接的样式隔离</li><li>希望保持单文件组件结构</li></ul><h4 id="选择shadow-dom当" tabindex="-1">选择<code>Shadow DOM</code>当： <a class="header-anchor" href="#选择shadow-dom当" aria-label="Permalink to &quot;选择\`Shadow DOM\`当：&quot;">​</a></h4><ul><li>开发可复用的<code>Web Components</code></li><li>需要最强的样式和 <code>DOM</code> 隔离</li><li>构建跨框架的组件库</li><li>不希望依赖构建工具</li></ul><h3 id="混合使用案例" tabindex="-1">混合使用案例 <a class="header-anchor" href="#混合使用案例" aria-label="Permalink to &quot;混合使用案例&quot;">​</a></h3><br><p>实际项目中经常混合使用多种技术：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 示例：在Web Components中使用CSS-in-JS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyComponent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HTMLElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> shadow</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;open&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 使用CSS-in-JS库生成样式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> styles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> css</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      button {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        background: \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAttribute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;color&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;blue&#39;};</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        color: white;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    shadow.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &lt;style&gt;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">styles</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&lt;/style&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &lt;button&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/button&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><br><p>每种技术都有其适用场景，选择时需要考虑：</p><ol><li><strong>项目需求</strong>：是否需要完全的 <code>DOM</code> 隔离？样式的动态程度如何？</li><li><strong>技术栈</strong>：使用的框架对哪种方案支持更好？</li><li><strong>团队熟悉度</strong>：团队成员对哪种技术更熟悉？</li><li><strong>性能要求</strong>：是否可以接受运行时开销？</li></ol><h2 id="element-attachshadow" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/attachShadow" target="_blank" rel="noreferrer">Element.attachShadow()</a> <a class="header-anchor" href="#element-attachshadow" aria-label="Permalink to &quot;[Element.attachShadow()](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/attachShadow)&quot;">​</a></h2><p><code>Element.attachShadow()</code> 方法给指定的元素挂载一个 <code>Shadow DOM</code>，并且返回对 <code>ShadowRoot</code> 的引用。</p><h3 id="可以被挂载的-shadow-dom-元素" tabindex="-1">可以被挂载的 <code>shadow DOM</code> 元素 <a class="header-anchor" href="#可以被挂载的-shadow-dom-元素" aria-label="Permalink to &quot;可以被挂载的 \`shadow DOM\` 元素&quot;">​</a></h3><br><p>要注意的是，不是每一种类型的元素都可以附加到 <code>shadow root</code>（影子根）下面。出于安全考虑，一些元素不能使用 <code>shadow DOM</code>（例如<code>&lt;a&gt;</code>），以及许多其他的元素。下面是一个可以挂载 <code>shadow root</code> 的元素列表：</p><ul><li>任何带有有效的名称且可独立存在的（<code>autonomous</code>）自定义元素</li><li><code>&lt;article&gt;</code></li><li><code>&lt;aside&gt;</code></li><li><code>&lt;blockquote&gt;</code></li><li><code>&lt;body&gt;</code></li><li><code>&lt;div&gt;</code></li><li><code>&lt;footer&gt;</code></li><li><code>&lt;h1&gt;</code></li><li><code>&lt;h2&gt;</code></li><li><code>&lt;h3&gt;</code></li><li><code>&lt;h4&gt;</code></li><li><code>&lt;h5&gt;</code></li><li><code>&lt;h6&gt;</code></li><li><code>&lt;header&gt;</code></li><li><code>&lt;main&gt;</code></li><li><code>&lt;nav&gt;</code></li><li><code>&lt;p&gt;</code></li><li><code>&lt;section&gt;</code></li><li><code>&lt;span&gt;</code></li></ul><h3 id="语法" tabindex="-1">语法 <a class="header-anchor" href="#语法" aria-label="Permalink to &quot;语法&quot;">​</a></h3><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options)</span></span></code></pre></div><h3 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-label="Permalink to &quot;参数&quot;">​</a></h3><p><code>options</code>: 一个包括下列字段的对象：</p>`,66)),i("ul",null,[s[13]||(s[13]=n(`<li><p><code>mode</code><br> 指定 <code>Shadow DOM</code> 树封装模式的字符串，可以是以下值：</p><ul><li><code>open</code>: <code>shadow root</code> 元素可以从 <code>js</code> 外部访问根节点，例如使用 <code>Element.shadowRoot</code>:</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;open&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">element.shadowRoot </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回一个 ShadowRoot 对象</span></span></code></pre></div><ul><li><code>closed</code>: 拒绝从 <code>js</code> 外部访问关闭的 <code>shadow root</code> 节点</li></ul><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">attachShadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;closed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">element.shadowRoot </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回 null</span></span></code></pre></div></li>`,1)),i("li",null,[i("p",null,[s[1]||(s[1]=i("code",null,"delegatesFocus",-1)),s[2]||(s[2]=a()),d(t,{bordered:!1,color:"cyan"},{default:k(()=>[...s[0]||(s[0]=[a("可选",-1)])]),_:1}),s[3]||(s[3]=i("br",null,null,-1)),s[4]||(s[4]=a(" 一个布尔值，当设置为 ",-1)),s[5]||(s[5]=i("code",null,"true",-1)),s[6]||(s[6]=a(" 时，指定减轻自定义元素的聚焦性能问题行为。当 ",-1)),s[7]||(s[7]=i("code",null,"shadow DOM",-1)),s[8]||(s[8]=a(" 中不可聚焦的部分被点击时，让第一个可聚焦的部分成为焦点，并且 ",-1)),s[9]||(s[9]=i("code",null,"shadow host",-1)),s[10]||(s[10]=a("（影子主机）将提供所有可用的 ",-1)),s[11]||(s[11]=i("code",null,":focus",-1)),s[12]||(s[12]=a(" 样式。",-1))])])]),s[15]||(s[15]=i("h3",{id:"返回值",tabindex:"-1"},[a("返回值 "),i("a",{class:"header-anchor",href:"#返回值","aria-label":'Permalink to "返回值"'},"​")],-1)),s[16]||(s[16]=i("br",null,null,-1)),s[17]||(s[17]=i("p",null,[a("返回一个 "),i("code",null,"ShadowRoot"),a(" 对象或者 "),i("code",null,"null"),a("。")],-1))])}const b=l(o,[["render",r]]);export{C as __pageData,b as default};
