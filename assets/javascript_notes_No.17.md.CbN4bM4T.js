import{_ as n,C as t,c as l,o as h,j as i,G as p,ab as k,a as e}from"./chunks/framework.CZTdqPay.js";const C=JSON.parse('{"title":"Note 17","description":"","frontmatter":{},"headers":[],"relativePath":"javascript/notes/No.17.md","filePath":"javascript/notes/No.17.md","lastUpdated":1747810090000}'),r={name:"javascript/notes/No.17.md"};function d(E,s,o,g,c,y){const a=t("BackTop");return h(),l("div",null,[s[0]||(s[0]=i("h1",{id:"note-17",tabindex:"-1"},[e("Note 17 "),i("a",{class:"header-anchor",href:"#note-17","aria-label":'Permalink to "Note 17"'},"​")],-1)),p(a),s[1]||(s[1]=k(`<h2 id="为什么-js-中-0-1-0-2-0-3" tabindex="-1">为什么 <code>js</code> 中 <code>0.1 + 0.2 !== 0.3</code>？ <a class="header-anchor" href="#为什么-js-中-0-1-0-2-0-3" aria-label="Permalink to &quot;为什么 \`js\` 中 \`0.1 + 0.2 !== 0.3\`？&quot;">​</a></h2><p>在 <code>JavaScript</code> 中，<code>0.1 + 0.2 !== 0.3</code> 的根本原因是计算机使用 <strong>二进制浮点数表示法</strong>（遵循 IEEE 754 标准）导致的精度丢失问题。以下是详细的解释：</p><h3 id="一、浮点数的二进制表示" tabindex="-1">一、浮点数的二进制表示 <a class="header-anchor" href="#一、浮点数的二进制表示" aria-label="Permalink to &quot;一、浮点数的二进制表示&quot;">​</a></h3><p>计算机用二进制存储数字，而许多十进制小数无法精确转换为二进制。例如：</p><ul><li><strong>0.1（十进制）</strong> 转换为二进制是 <code>0.00011001100110011...</code>（无限循环）。</li><li><strong>0.2（十进制）</strong> 转换为二进制是 <code>0.0011001100110011...</code>（无限循环）。</li></ul><p>这些无限循环的二进制小数在存储时会被 <strong>截断</strong> 或 <strong>舍入</strong>，导致精度丢失。</p><h3 id="二、ieee-754-双精度浮点数" tabindex="-1">二、IEEE 754 双精度浮点数 <a class="header-anchor" href="#二、ieee-754-双精度浮点数" aria-label="Permalink to &quot;二、IEEE 754 双精度浮点数&quot;">​</a></h3><p><code>JavaScript</code> 使用 <strong>64位双精度浮点数</strong>（Double-precision floating-point）存储数值，其结构为：</p><ul><li><strong>1位符号位</strong>：表示正负。</li><li><strong>11位指数位</strong>：决定数值的范围。</li><li><strong>52位尾数位</strong>：存储有效数字（二进制小数部分）。</li></ul><p>由于尾数位有限（52位），当十进制小数转换为二进制后长度超过 <code>52</code> 位时，会 <strong>舍入到最近的近似值</strong>，从而引发精度误差。</p><h3 id="三、0-1-0-2-的计算过程" tabindex="-1">三、0.1 + 0.2 的计算过程 <a class="header-anchor" href="#三、0-1-0-2-的计算过程" aria-label="Permalink to &quot;三、0.1 + 0.2 的计算过程&quot;">​</a></h3><ol><li><strong>存储近似值</strong>： <ul><li><code>0.1</code> 的二进制近似值在计算机中存储为 <code>0.10000000000000000555...</code>。</li><li><code>0.2</code> 的二进制近似值存储为 <code>0.20000000000000001110...</code>。</li></ul></li><li><strong>加法运算</strong>： <ul><li>二进制加法后的结果约为 <code>0.30000000000000004440...</code>。</li></ul></li><li><strong>十进制转换</strong>： <ul><li>最终的十进制结果近似为 <code>0.30000000000000004</code>，因此 <code>0.1 + 0.2 !== 0.3</code>。</li></ul></li></ol><h3 id="四、验证与解决方案" tabindex="-1">四、验证与解决方案 <a class="header-anchor" href="#四、验证与解决方案" aria-label="Permalink to &quot;四、验证与解决方案&quot;">​</a></h3><h4 id="_1-验证精度问题" tabindex="-1">1. 验证精度问题 <a class="header-anchor" href="#_1-验证精度问题" aria-label="Permalink to &quot;1. 验证精度问题&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 0.30000000000000004</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false</span></span></code></pre></div><h4 id="_2-解决方案" tabindex="-1">2. 解决方案 <a class="header-anchor" href="#_2-解决方案" aria-label="Permalink to &quot;2. 解决方案&quot;">​</a></h4><ul><li><p><strong>方法一：容忍微小误差</strong> 使用一个极小的误差范围（如 <code>Number.EPSILON</code>）比较结果：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Number.EPSILON</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span></code></pre></div></li><li><p><strong>方法二：转为整数运算</strong> 将小数转换为整数计算后再还原：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 0.3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span></code></pre></div></li><li><p><strong>方法三：使用 <code>toFixed</code>（需谨慎）</strong> 截断小数位数（注意 <code>toFixed</code> 可能四舍五入）：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;0.3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sum) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span></code></pre></div></li><li><p><strong>方法四：使用高精度库</strong><br> 如 <code>decimal.js</code> 或 <code>big.js</code> 处理精确计算：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Decimal } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;decimal.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Decimal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span></code></pre></div></li></ul><h3 id="五、这不是-javascript-的-缺陷" tabindex="-1">五、这不是 JavaScript 的“缺陷”！ <a class="header-anchor" href="#五、这不是-javascript-的-缺陷" aria-label="Permalink to &quot;五、这不是 JavaScript 的“缺陷”！&quot;">​</a></h3><ul><li><strong>所有遵循 IEEE 754 的语言都有此问题</strong>（如 Python、Java、C++）。</li><li><strong>这是二进制浮点数的固有特性</strong>，与语言无关。</li><li><strong>整数计算不会出现此问题</strong>（例如 <code>0.5 + 0.5 === 1</code>，因为 <code>0.5</code> 是二进制有限小数）。</li></ul><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p><code>0.1 + 0.2 !== 0.3</code> 的原因是：</p><ol><li>十进制小数转换为二进制时丢失精度。</li><li>浮点数的存储和计算基于近似值。</li><li>误差在运算过程中被放大。</li></ol><p>理解这一机制后，可以通过数学方法或第三方库规避精度问题。</p><h2 id="定义类的私有属性" tabindex="-1">定义类的私有属性 <a class="header-anchor" href="#定义类的私有属性" aria-label="Permalink to &quot;定义类的私有属性&quot;">​</a></h2><p>在 <code>JavaScript</code> 中，定义类的私有属性可以通过以下几种方式实现：</p><h3 id="_1-使用-语法-es2022-官方私有字段" tabindex="-1">1. <strong>使用 <code>#</code> 语法（ES2022+ 官方私有字段）</strong> <a class="header-anchor" href="#_1-使用-语法-es2022-官方私有字段" aria-label="Permalink to &quot;1. **使用 \`#\` 语法（ES2022+ 官方私有字段）**&quot;">​</a></h3><br><p><strong>实现方式</strong>： 在类中通过 <code>#</code> 前缀声明属性，该属性仅在类的内部可访问。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  #privateProp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;secret&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 私有属性</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.#privateProp </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 内部可访问</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.#privateProp) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 语法错误：外部无法访问</span></span></code></pre></div><p><strong>特点</strong>：</p><ul><li>语言原生支持，严格意义上的私有属性。</li><li>外部访问会直接报错（语法错误）。</li><li>子类也无法访问父类的私有属性。</li><li>需要较新的运行环境支持（如 Node.js 12+、现代浏览器）。</li></ul><hr><h3 id="_2-闭包-特权方法" tabindex="-1">2. <strong>闭包 + 特权方法</strong> <a class="header-anchor" href="#_2-闭包-特权方法" aria-label="Permalink to &quot;2. **闭包 + 特权方法**&quot;">​</a></h3><br><p><strong>实现方式</strong>：</p><p>在构造函数中通过局部变量保存私有属性，并通过闭包暴露访问方法。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> privateProp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;secret&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 局部变量</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPrivate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> privateProp </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 特权方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.privateProp) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// undefined（无法直接访问）</span></span></code></pre></div><p><strong>特点</strong>：</p><ul><li>兼容性好（支持所有 ES6 环境）。</li><li>每个实例会创建独立的方法，可能占用更多内存。</li><li>私有属性通过闭包隐藏，外部无法直接访问。</li></ul><h3 id="_3-weakmap-存储私有属性" tabindex="-1">3. <strong>WeakMap 存储私有属性</strong> <a class="header-anchor" href="#_3-weakmap-存储私有属性" aria-label="Permalink to &quot;3. **WeakMap 存储私有属性**&quot;">​</a></h3><br><p><strong>实现方式</strong>：</p><p>使用 <code>WeakMap</code> 以实例为键存储私有属性，避免内存泄漏。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _privateProps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WeakMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _privateProps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { privateProp: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;secret&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _privateProps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).privateProp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.privateProp) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// undefined</span></span></code></pre></div><p><strong>特点</strong>：</p><ul><li>私有属性完全隐藏，外部无法通过实例或反射获取。</li><li>需要维护额外的 <code>WeakMap</code>，代码稍显繁琐。</li><li>适合需要多个私有属性的场景（可存储为对象）。</li></ul><h3 id="_4-symbol-作为属性键" tabindex="-1">4. <strong>Symbol 作为属性键</strong> <a class="header-anchor" href="#_4-symbol-作为属性键" aria-label="Permalink to &quot;4. **Symbol 作为属性键**&quot;">​</a></h3><br><p><strong>实现方式</strong>：</p><p>用 <code>Symbol</code> 作为属性名，外部无法直接获取 <code>Symbol</code> 引用。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在模块或闭包中定义 Symbol（确保外部无法访问）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> _privateProp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;privateProp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[_privateProp] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[_privateProp]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance[_privateProp]) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 需要 _privateProp 才能访问</span></span></code></pre></div><p><strong>说明</strong></p><ul><li><code>Symbol</code> 的唯一性：每个 <code>Symbol(&#39;name&#39;)</code> 都是唯一的，只要不将 <code>_name</code> 暴露给外部，外部无法直接通过属性名访问。</li><li>模块化封装：如果将上述代码放在模块中，且不导出 <code>_name</code>，则外部无法获取该 <code>Symbol</code>。</li><li>反射方法的局限：通过 <code>Object.getOwnPropertySymbols(person)</code> 可以获取对象的所有 <code>Symbol</code> 属性，但需要主动遍历才能找到对应属性，增加了访问成本。</li></ul><p><strong>特点</strong>：</p><ul><li>外部需持有 <code>Symbol</code> 才能访问，否则无法直接读取。</li><li>通过 <code>Object.getOwnPropertySymbols()</code> 仍可获取属性键，并非严格私有。</li><li>适合模块内私有（不导出 <code>Symbol</code> 时）。</li></ul><h3 id="_5-命名约定-如-前缀" tabindex="-1">5. <strong>命名约定（如 <code>_</code> 前缀）</strong> <a class="header-anchor" href="#_5-命名约定-如-前缀" aria-label="Permalink to &quot;5. **命名约定（如 \`_\` 前缀）**&quot;">​</a></h3><br><p><strong>实现方式</strong>：</p><p>通过代码规范（如 <code>_privateProp</code>）约定私有属性，但不强制限制访问。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._privateProp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._privateProp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPrivate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;secret&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance._privateProp) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;secret&#39;（外部仍可访问）</span></span></code></pre></div><p><strong>特点</strong>：</p><ul><li>仅通过命名约定提示开发者“不要直接访问”。</li><li>无强制保护，属性实际是公开的。</li><li>兼容性最好，但依赖团队规范。</li></ul><h3 id="总结对比" tabindex="-1"><strong>总结对比</strong> <a class="header-anchor" href="#总结对比" aria-label="Permalink to &quot;**总结对比**&quot;">​</a></h3><table tabindex="0"><thead><tr><th>方法</th><th>严格私有性</th><th>内存效率</th><th>兼容性</th><th>代码简洁性</th></tr></thead><tbody><tr><td><code>#</code> 语法</td><td>✅</td><td>✅</td><td>需现代环境</td><td>✅</td></tr><tr><td>闭包 + 特权方法</td><td>✅</td><td>❌</td><td>所有 ES6+</td><td>❌</td></tr><tr><td>WeakMap</td><td>✅</td><td>✅</td><td>所有 ES6+</td><td>❌</td></tr><tr><td>Symbol</td><td>❌</td><td>✅</td><td>所有 ES6+</td><td>✅</td></tr><tr><td>命名约定</td><td>❌</td><td>✅</td><td>所有环境</td><td>✅</td></tr></tbody></table><p><strong>推荐选择</strong>：</p><ul><li><strong>现代项目</strong>：优先使用 <code>#</code> 语法（ES2022+）。</li><li><strong>兼容旧环境</strong>：选择 <strong>WeakMap</strong> 或 <strong>闭包</strong>。</li><li>避免依赖 <strong>Symbol</strong> 或 <strong>命名约定</strong> 实现严格私有。</li></ul>`,66))])}const u=n(r,[["render",d]]);export{C as __pageData,u as default};
